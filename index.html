<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>모의 총장 선거</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, set, update } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyBdeselBDpz93tvUhiX7vvf4TMsc-37clA",
            authDomain: "mockvote-2a386.firebaseapp.com",
            databaseURL: "https://mockvote-2a386-default-rtdb.firebaseio.com",
            projectId: "mockvote-2a386",
            storageBucket: "mockvote-2a386.firebasestorage.app",
            messagingSenderId: "45371352854",
            appId: "1:45371352854:web:8386683d0222f656901237",
            measurementId: "G-QXKHYTXBSS"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        const candidates = [
            "후보 1번", "후보 2번", "후보 3번", "후보 4번", "후보 5번", "후보 6번", 
            "후보 7번", "후보 8번", "후보 9번", "후보 10번", "후보 11번", "후보 12번", 
            "후보 13번", "후보 14번", "후보 15번"
        ];
        let hasVoted = false;

        function vote(candidateIndex) {
            if (hasVoted) {
                alert("이미 투표하셨습니다. 한 번만 투표할 수 있습니다.");
                return;
            }
            hasVoted = true;

            const candidateName = candidates[candidateIndex];
            const candidateRef = ref(database, 'votes/' + candidateName);
            update(candidateRef, { votes: incrementValue(candidateRef) })
                .then(() => alert(`${candidateName}에 투표하셨습니다!`))
                .catch(err => console.error("Database Error:", err));
        }

        function showResults() {
            const password = prompt("투표 결과를 보려면 암호를 입력하세요:");
            if (password === "hufsmockvote") {
                const votesRef = ref(database, 'votes');
                get(votesRef).then(snapshot => {
                    let results = "투표 결과:\\n\\n";
                    snapshot.forEach(childSnapshot => {
                        const candidateName = childSnapshot.key;
                        const voteCount = childSnapshot.val();
                        results += `${candidateName}: ${voteCount}표\\n`;
                    });
                    alert(results);
                }).catch(err => console.error("결과 가져오기 오류:", err));
            } else {
                alert("암호가 틀렸습니다.");
            }
        }

        function resetVotes() {
            const password = prompt("투표 데이터를 초기화하려면 암호를 입력하세요:");
            if (password === "hufsmockvote") {
                const votesRef = ref(database, 'votes');
                set(votesRef, null) // 데이터를 초기화
                    .then(() => alert("투표 데이터가 초기화되었습니다."))
                    .catch(err => console.error("초기화 오류:", err));
            } else {
                alert("암호가 틀렸습니다.");
            }
        }
    </script>
</head>
<body>
    <h1>모의 총장 선거</h1>
    <p>아래에서 후보를 선택하세요:</p>
    <div id="candidates">
        <ul>
            <script>
                candidates.forEach((candidate, index) => {
                    document.write(`<li><button onclick="vote(${index})">${candidate}</button></li>`);
                });
            </script>
        </ul>
    </div>
    <br>
    <button onclick="showResults()">결과 보기 (관리자 전용)</button>
    <button onclick="resetVotes()">투표 초기화 (관리자 전용)</button>
</body>
</html>